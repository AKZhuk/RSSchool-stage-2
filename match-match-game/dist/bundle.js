(()=>{"use strict";var e={596:(e,t,s)=>{s.r(t)},477:(e,t,s)=>{s.r(t)},766:(e,t,s)=>{s.r(t)},336:(e,t,s)=>{s.r(t)},528:(e,t,s)=>{s.r(t)},184:(e,t,s)=>{s.r(t)},148:(e,t,s)=>{s.r(t)},387:(e,t,s)=>{s.r(t)},752:function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const i=s(88),a=s(54),r=s(229),o=s(977),l=s(831),c=s(49),d=s(178);t.App=class{constructor(e){this.rootElement=e,this.iDB=new c.Database,this.iDB.init(),this.header=new o.Header,this.main=new d.BaseComponent("main",["main"]),this.about=new a.About,this.bestScore=new i.BestScore,this.settings=new l.Settings,this.game=new r.Game,this.routes={about:this.about.element,"best-score":this.bestScore.element,settings:this.settings.element,game:this.game.element},this.rootElement.appendChild(this.header.element),this.rootElement.appendChild(this.main.element),window.location.hash="about",this.header.toggleActiveLink("about"),this.main.element.appendChild(this.about.element)}onNav(e){this.header.toggleActiveLink(e),"best-score"===e&&this.iDB.readAll("users").then((e=>{this.bestScore.renderScore(e)})),"#game"===window.location.hash&&(this.game.resetGame(),this.header.addStartGameButton()),window.location.hash=e}clear(){this.main.element.innerHTML=""}start(){return n(this,void 0,void 0,(function*(){const e=yield fetch("./images.json"),t=yield e.json(),s=t[this.settings.settingsValues[0]],n=this.settings.settingsValues[1],i=s.images.slice(0,n).map((e=>`${t[this.settings.settingsValues[0]].category}/${e}`));this.game.newGame(i,n)}))}addListeners(){window.onpopstate=()=>{const e=window.location.hash.slice(1);this.clear(),this.header.toggleActiveLink(e),this.main.element.appendChild(this.routes[e])},this.header.StartGameButton.element.addEventListener("click",(e=>{const t=e.target;this.start(),this.onNav(t.dataset.link),this.header.addStopGameButton()})),this.header.StopGameButton.element.addEventListener("click",(e=>{e.preventDefault(),this.game.resetGame();const t=e.target;this.onNav(t.dataset.link)})),window.onload=()=>{document.querySelectorAll(".navigation__item").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const t=e.target;this.onNav(t.dataset.link)}))}))},this.game.modal.element.addEventListener("submit",(e=>{e.preventDefault();const t={firstName:this.game.modal.inputs[0].element.value,lastName:this.game.modal.inputs[1].element.value,email:this.game.modal.inputs[2].element.value,image:this.game.modal.canvas.base64Files,score:this.game.modal.score};this.iDB.write("users",t),this.onNav("best-score")})),this.game.modal.buttonCancel.element.addEventListener("click",(e=>{e.preventDefault(),this.onNav("about")}))}}},54:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.About=void 0;const n=s(178);s(596);class i extends n.BaseComponent{constructor(){super("div",["game-field","wrapper"]),this.element.innerHTML='<h2 class="title">How to play?</h2>\n      <div class="how-to-play">\n\n\n        <section class="how-to-play__item">\n          <figure class="circle">1</figure>\n          <span class="how-to-play__text">Configure your game settings</span>\n        </section>\n        <a href="#" data-link="settings" class="navigation__item btn_game-settings"\n          >\n          <figure class="settings-svg about__svg"></figure>\n          Game Settings</a\n        >\n        <section class="how-to-play__item">\n          <figure class="circle">2</figure>\n          <span class="how-to-play__text"\n            >Start you new game! Remember card <br />positions and match it before times up.</span\n          >\n        </section>\n        <section class="how-to-play__item preview-img"></section>\n         <section class="how-to-play__item relative">\n          <figure class="circle">3</figure>\n          <span class="how-to-play__text">Register new player in game for best scores</span>\n          <div class=\'message\'><b>Информация для проверяющего:</b>\n            Форма регистрация отображается после окончания игры. Данная реализация\n            разрешена автором таска\n            <a href=\' https://docs.google.com/spreadsheets/d/1friRvR7djdTnfTVDhpeTcMEDiD-RIwxHO_V8wcGe65o/edit#gid=0\'>\n           см строку 41</a>\n          </div>\n        </section>\n        <section class="how-to-play__item form-img"></section>\n      </div>\n    '}}t.About=i},88:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BestScore=void 0;const n=s(496),i=s(178);s(477);class a extends i.BaseComponent{constructor(){super("div",["wrapper","best-scores"]),this.title=new i.BaseComponent("h2",["title"],"Best players"),this.wrapper=new i.BaseComponent("div",["testtt"]),this.element.appendChild(this.title.element),this.element.appendChild(this.wrapper.element)}clearScore(){this.wrapper.element.innerHTML=""}renderScore(e){this.clearScore(),e.sort(((e,t)=>e.score>t.score?-1:0)),e.slice(0,10).forEach((e=>{const t=new n.Canvas("user__avatar");t.drawImage(e.image);const s=new i.BaseComponent("section",["top-players"]);this.wrapper.element.appendChild(s.element),s.element.innerHTML+=`\n        <div class='top-players__user user'>\n        <div class="user__information">\n          <h3 class="user__name">${e.firstName} ${e.lastName}</h3 >\n          <h4 class="user__email" > ${e.email}</h4></div>\n        </div>\n        <div class="top-players__score score">\n          <span class="Score__title">Score:</span>\n          <output class="score__result"> ${e.score}</output>\n        </div>`,s.element.appendChild(t.element)}))}}t.BestScore=a},128:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Card=void 0;const n=s(178);s(766);class i extends n.BaseComponent{constructor(e,t){super("div",["card-container",`card-${t}`]),this.image=e,this.isCorrect=!1,this.element.innerHTML=`\n      <div class="card">\n        <div class="card__front" style="background-image: url('./images/${e}')">\n          <div class="card__cover"></div>\n        </div>\n        <div class="card__back"></div>\n      </div>`}flipToBack(){return this.flip(!0)}flipToFront(){return this.flip()}changeStatus(e){"correct"===e&&(this.isCorrect=!0);const t=this.element.querySelector(".card__cover");null==t||t.classList.toggle(`${e}`)}flip(e=!1){return new Promise((t=>{this.element.classList.toggle("flip",e),this.element.addEventListener("transitionend",(()=>t()),{once:!0})}))}}t.Card=i},168:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameField=void 0;const n=s(178);class i extends n.BaseComponent{constructor(){super("div",["game-field"]),this.cards=[]}clear(){this.cards=[],this.element.innerHTML=""}addCards(e){this.cards=e,this.cards.forEach((e=>this.element.appendChild(e.element))),setTimeout((()=>{this.cards.forEach((e=>e.flipToBack()))}),5e3)}}t.GameField=i},229:function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;const i=s(680),a=s(168),r=s(178),o=s(128),l=s(359),c=s(298);s(336);class d extends r.BaseComponent{constructor(){super("div",["game","wrapper"]),this.isAnimation=!1,this.gameResult={flips:0,corrects:0,mistakes:0,cardsPairs:0},this.timer=new c.Timer,this.gameField=new a.GameField,this.modal=new l.Registration,this.element.appendChild(this.timer.element),this.element.appendChild(this.gameField.element)}resetGame(){this.gameField.clear(),this.activeCard=void 0,this.isAnimation=!1,this.timer.stop(),this.timer.clear(),this.gameResult.mistakes=0,this.gameResult.corrects=0,this.gameResult.flips=0}newGame(e,t){this.resetGame(),this.gameResult.cardsPairs=e.length;const s=e.concat(e).map((e=>new o.Card(e,t))).sort((()=>Math.random()-.5));this.gameField.addCards(s),setTimeout((()=>{this.timer.start(),s.forEach((e=>{e.element.addEventListener("click",(()=>{this.cardHandler(e)}))}))}),5e3)}showModal(e,t,s){this.modal.render(e,t,s),this.gameField.element.appendChild(this.modal.element)}cardHandler(e){return n(this,void 0,void 0,(function*(){if(!this.isAnimation&&!e.isCorrect&&e!==this.activeCard){if(this.isAnimation=!0,yield e.flipToFront(),!this.activeCard)return this.activeCard=e,void(this.isAnimation=!1);if(this.gameResult.flips++,this.activeCard.image!==e.image)e.changeStatus("mistake"),this.activeCard.changeStatus("mistake"),yield i.delay(2e3),yield Promise.all([this.activeCard.changeStatus("mistake"),e.changeStatus("mistake"),this.activeCard.flipToBack(),e.flipToBack()]),this.gameResult.mistakes++;else if(e.changeStatus("correct"),this.activeCard.changeStatus("correct"),this.gameResult.corrects++,this.gameResult.corrects===this.gameResult.cardsPairs){this.timer.stop();const e=this.calculateScore(this.timer.min,this.timer.sec);this.showModal(e,this.timer.min,this.timer.sec)}this.isAnimation=!1,this.activeCard=void 0}}))}calculateScore(e,t){const s=100*(this.gameResult.flips-this.gameResult.mistakes)-10*(60*e+t);return s<0?0:s}}t.Game=d},977:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;const n=s(178),i=s(955),a=s(660),r=s(628);s(528);class o extends n.BaseComponent{constructor(){super("header",["header"]),this.logo=new n.BaseComponent("div",["logo"]),this.navigationWrapper=new n.BaseComponent("div",["header__navigation"]),this.StartGameButton=new i.Button(["btn"],"Start Game","game","a"),this.StopGameButton=new i.Button(["btn"],"STOP GAME","about","a"),this.element.appendChild(this.logo.element),this.element.appendChild(this.navigationWrapper.element),r.navLinkParam.forEach((e=>{const t=new a.NavItem(e.text,e.link,e.svgClass);this.navigationWrapper.element.appendChild(t.element)})),this.element.appendChild(this.StartGameButton.element)}addStopGameButton(){this.element.removeChild(this.StartGameButton.element),this.element.appendChild(this.StopGameButton.element)}addStartGameButton(){this.element.removeChild(this.StopGameButton.element),this.element.appendChild(this.StartGameButton.element)}toggleActiveLink(e){var t;this.element.querySelectorAll(".navigation__item").forEach((e=>{e.classList.remove("active")})),null===(t=document.getElementById(`${e}`))||void 0===t||t.classList.add("active")}}t.Header=o},660:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NavItem=void 0;const n=s(178),i=s(955);class a extends i.Button{constructor(e,t,s){super(["navigation__item"],e,t,"a"),this.element.id=t,this.svg=new n.BaseComponent("figure",["navigation__svg",`${s}`]),this.element.appendChild(this.svg.element)}}t.NavItem=a},471:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Input=void 0;const n=s(178);class i extends n.BaseComponent{constructor(e,t,s,n,i,a){super("input",["form__input"]),this.element.id=e,this.isValid=!1,this.element.setAttribute("type",t),this.element.setAttribute("maxlength","30"),this.errField=n,this.element.addEventListener("input",(e=>{this.element.className="form__input";const{value:t}=e.target;this.errField.innerText="",this.isValid=this.checkIsEmpty(),s.forEach((e=>{let s=t.match(e.RegExp);"email"===this.element.id&&(s=null!=s?null:["error"]),null!=s&&(this.element.classList.add("input_error"),this.errField.innerText=e.errMessage,this.isValid=!1)})),this.isValid&&(this.element.className="form__input input_valid"),i.every((e=>e.isValid))?a.element.removeAttribute("disabled"):a.element.setAttribute("disabled","")}))}checkIsEmpty(){const{value:e}=this.element;return""!==e||(this.errField.innerText="заполните это поле",this.isValid=!1,!1)}}t.Input=i},143:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InputFile=void 0;const n=s(178);class i extends n.BaseComponent{constructor(e){super("input",["form__image-input"]),this.element.setAttribute("type","file"),this.element.addEventListener("change",(()=>{const t=this.element.files;if(!t)return;const s=new FileReader;s.onload=()=>{e.drawImage(s.result),this.element.value=""},s.readAsDataURL(t[0])}))}}t.InputFile=i},359:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Registration=void 0;const n=s(178),i=s(955),a=s(471),r=s(143),o=s(496),l=s(628);s(184);class c extends n.BaseComponent{constructor(){super("div",["cover"]),this.inputs=[],this.score=0,this.form=new n.BaseComponent("form",["form"]),this.congratulation=new n.BaseComponent("span",["congratulations__text"]),this.formWrapper=new n.BaseComponent("div",["form-wrapper"]),this.buttonWrapper=new n.BaseComponent("div",["form__buttons-wrapper"]),this.buttonAdd=new i.Button(["btn","btn_add-user"],"ADD USER","about","button",!0),this.canvas=new o.Canvas("form__image"),this.inputFile=new r.InputFile(this.canvas),this.buttonCancel=new i.Button(["btn","btn_cancel"],"CANCEL","about");const e=new n.BaseComponent("div",["form__avatar"]).element;this.element.appendChild(this.form.element),e.appendChild(this.canvas.element),e.appendChild(this.inputFile.element),this.form.element.appendChild(this.congratulation.element),this.form.element.appendChild(new n.BaseComponent("h2",["title"],"Registr new Player").element),this.form.element.appendChild(e),this.form.element.appendChild(this.formWrapper.element),this.form.element.appendChild(this.buttonWrapper.element),this.buttonWrapper.element.appendChild(this.buttonAdd.element),this.buttonWrapper.element.appendChild(this.buttonCancel.element)}clear(){this.congratulation.element.innerText="",this.formWrapper.element.innerHTML="",this.inputs=[],this.canvas.clear()}render(e,t,s){this.clear(),this.score=e,this.congratulation.element.innerText=`\n    Congratulations! You successfully found all matches on ${t}.${s} minutes.`,l.inputsParam.forEach((e=>{const t=new n.BaseComponent("label",["form__label"],e.labelText),s=new n.BaseComponent("div",["input_error-message"],"заполните это поле"),i=new a.Input(e.id,e.type,e.rule,s.element,this.inputs,this.buttonAdd);this.inputs.push(i),this.formWrapper.element.appendChild(i.element),this.formWrapper.element.appendChild(t.element),this.formWrapper.element.appendChild(s.element)}))}}t.Registration=c},422:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Option=void 0;const n=s(178);class i extends n.BaseComponent{constructor(e,t){super("option",[`${e}`],`${e}`),this.element.setAttribute("value",t)}}t.Option=i},295:function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Select=void 0;const i=s(178),a=s(422);class r extends i.BaseComponent{constructor(e,t){super("select",[`${e}`]),this.name=e,this.json=t}getOptions(){return n(this,void 0,void 0,(function*(){const e=yield fetch(`./${this.json}`);(yield e.json()).forEach((e=>{const t=e.value,s=new a.Option(`${e.category}`,t);this.element.appendChild(s.element)}))}))}}t.Select=r},831:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Settings=void 0;const n=s(178),i=s(295);s(148);class a extends n.BaseComponent{constructor(){super("div",["wrapper","best-scores"]),this.settings=[new i.Select("Categories","images.json"),new i.Select("Difficulty","difficulties.json")],this.settingsValues=[0,8],this.settings.forEach(((e,t)=>{this.element.appendChild(new n.BaseComponent("h2",["setting__name"],`${e.element.classList}`).element),e.getOptions(),this.element.appendChild(e.element),e.element.addEventListener("change",(e=>{this.settingsValues[t]=Number(e.target.value)}))}))}}t.Settings=a},178:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseComponent=void 0,t.BaseComponent=class{constructor(e="div",t=[],s=""){this.element=document.createElement(e),this.element.classList.add(...t),this.element.innerText=s}}},955:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;const n=s(178);class i extends n.BaseComponent{constructor(e,t,s,n="button",i){super(n,e,t),this.element.dataset.link=s,i&&(this.element.setAttribute("type","submit"),this.element.setAttribute("disabled",""))}}t.Button=i},496:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0;const n=s(178);class i extends n.BaseComponent{constructor(e){super("canvas",["canvas",e]),this.base64Files="",this.element.setAttribute("width","168"),this.element.setAttribute("height","168")}drawImage(e){const t=new Image;t.src=e,t.style.objectFit="cover",t.onload=()=>{const e=this.element.getContext("2d");t.width>t.height?e.drawImage(t,0,0,t.width*(168/t.height),168):e.drawImage(t,0,0,168,t.height*(168/t.width)),this.base64Files=this.element.toDataURL()}}clear(){this.element.getContext("2d").clearRect(0,0,198,198)}}t.Canvas=i},628:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.navLinkParam=t.inputsParam=void 0,t.inputsParam=[{id:"first-name",type:"text",labelText:"First name",rule:[{RegExp:/^\d{1,}$/gi,errMessage:" Имя не может состоять из цифр."},{RegExp:/[~!@#$%*()_—+=|:;"'`<>,.?/^]/gi,errMessage:"Имя не может содержать: (~ ! @ # $ % * () _ — + = | : ; \" ' ` < > , . ? / ^)"}]},{id:"last-name",type:"text",labelText:"Last Name",rule:[{RegExp:/^\d{1,}$/gi,errMessage:" Имя не может состоять из цифр."},{RegExp:/[~!@#$%*()_—+=|:;"'`<>,.?/^]/gi,errMessage:"Фамилия не может содержать: (~ ! @ # $ % * () _ — + = | : ; \" ' ` < > , . ? / ^)"}]},{id:"email",type:"text",labelText:"Email",rule:[{RegExp:/^(?:[()a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}()~-]+)*|"(?:[ "\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]? [0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i,errMessage:"email должен соответствовать стандартному правилу формированию email"}]}],t.navLinkParam=[{link:"about",text:"About Game",svgClass:"about-svg"},{link:"best-score",text:"Best Score",svgClass:"best-score-svg"},{link:"settings",text:"Game Settings",svgClass:"settings-svg"}]},49:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Database=void 0,t.Database=class{init(){const e=window.indexedDB.open("AKZhuk",1);e.onupgradeneeded=()=>{const t=e.result;t.createObjectStore("users",{keyPath:"id",autoIncrement:!0}),this.db=t},e.onsuccess=()=>{this.db=e.result},e.onerror=()=>{throw new Error(`Errror has occured! Abort, ${e.error}`)}}write(e,t){const s=this.db.transaction(e,"readwrite"),n=s.objectStore(e).add(t);n.onsuccess=()=>{},n.onerror=()=>{throw new Error(`Errror has occured! Writing in DB error, ${s.error}`)},s.onabort=()=>{throw new Error(`Errror has occured! Abort, ${s.error}`)}}readAll(e){return new Promise(((t,s)=>{const n=this.db.transaction(e,"readonly"),i=n.objectStore(e).getAll();n.oncomplete=()=>{t(i.result)},n.onerror=()=>{s(new Error(`Errror has occured! read data from DB error, ${n.error}`))}}))}}},680:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0,t.delay=function(e){return new Promise((t=>{setTimeout(t,e)}))}},298:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=void 0;const n=s(178);class i extends n.BaseComponent{constructor(){super("div",["timer"]),this.clock=0,this.offset=0,this.min=0,this.sec=0,this.interval=null,this.update=this.update.bind(this)}start(){this.interval||(this.offset=Date.now(),this.interval=setInterval(this.update.bind(this),1),this.min=0)}stop(){this.interval&&(clearInterval(this.interval),this.interval=null)}reset(){this.clock=0,this.render()}clear(){this.element.innerHTML="00<p>:</p>00",this.min=0,this.sec=0,this.clock=0}delta(){const e=Date.now(),t=e-this.offset;return this.offset=e,t}update(){this.clock+=this.delta(),this.render()}render(){this.sec=Math.floor(this.clock/1e3),60===this.sec&&(this.min++,this.reset()),this.element.innerHTML=`${this.min<10?`0${this.min}`:this.min}:${this.sec<10?`0${this.sec}`:this.sec}`}}t.Timer=i}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,s),a.exports}s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const e=s(752);s(387),new e.App(document.body).addListeners()})()})();