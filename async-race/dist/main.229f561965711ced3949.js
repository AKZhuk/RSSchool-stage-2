(()=>{"use strict";var e={387:(e,n,t)=>{t.r(n)},203:function(e,n){var t=this&&this.__awaiter||function(e,n,t,a){return new(t||(t=Promise))((function(i,r){function o(e){try{d(a.next(e))}catch(e){r(e)}}function s(e){try{d(a.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((a=a.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.deleteCar=n.deleteWinner=n.saveWinner=n.updateWinner=n.createWinner=n.isInWinner=n.getWinner=n.getWinners=n.drive=n.stopEngine=n.startEngine=n.toggleEngine=n.updateCar=n.createCar=n.getCar=n.getAllCars=n.getCars=void 0;const a="http://127.0.0.1:3000",i=`${a}/garage`,r=`${a}/engine`,o=`${a}/winners`;n.getCars=(e,n)=>t(void 0,void 0,void 0,(function*(){const t=yield fetch(`${i}?_page=${e}&_limit=${n}`);return{items:yield t.json(),count:t.headers.get("X-Total-Count")}})),n.getAllCars=()=>t(void 0,void 0,void 0,(function*(){const e=yield fetch(`${i}?`);return{items:yield e.json(),count:e.headers.get("X-Total-Count")}})),n.getCar=e=>t(void 0,void 0,void 0,(function*(){return(yield fetch(`${i}/${e}`)).json()})),n.createCar=e=>t(void 0,void 0,void 0,(function*(){(yield fetch(i,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/JSON"}})).json()})),n.updateCar=(e,n)=>t(void 0,void 0,void 0,(function*(){(yield fetch(`${i}/${e}`,{method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/JSON"}})).json()})),n.toggleEngine=(e,n)=>t(void 0,void 0,void 0,(function*(){return(yield fetch(`${r}?id=${e}&status=${n}`)).json()})),n.startEngine=e=>t(void 0,void 0,void 0,(function*(){document.getElementById(`engine-${e}`).setAttribute("disabled","");const n=yield fetch(`${r}?id=${e}&status=started`);return document.getElementById(`resetCar-${e}`).removeAttribute("disabled"),n.json()})),n.stopEngine=e=>t(void 0,void 0,void 0,(function*(){document.getElementById(`resetCar-${e}`).setAttribute("disabled","");const n=yield fetch(`${r}?id=${e}&status=stoppeded`);return document.getElementById(`engine-${e}`).removeAttribute("disabled"),n.json()})),n.drive=e=>t(void 0,void 0,void 0,(function*(){const n=yield fetch(`${r}?id=${e}&status=drive`);return 200!==n.status?{success:!1}:Object.assign({},yield n.json())})),n.getWinners=(e,n,a="id",i)=>t(void 0,void 0,void 0,(function*(){const t=yield fetch(`${o}?_page=${e}&_limit=${n}&_sort=${a}&_order=${i}`);return{items:yield t.json(),count:t.headers.get("X-Total-Count")}})),n.getWinner=e=>t(void 0,void 0,void 0,(function*(){return(yield fetch(`${o}/${e}`)).json()})),n.isInWinner=e=>t(void 0,void 0,void 0,(function*(){return fetch(`${o}/${e}`).then((e=>e.status)).catch((e=>{throw new Error(`not in winner, ${e}`)}))})),n.createWinner=e=>t(void 0,void 0,void 0,(function*(){(yield fetch(o,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/JSON"}})).json()})),n.updateWinner=(e,n)=>t(void 0,void 0,void 0,(function*(){(yield fetch(`${o}/${e}`,{method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/JSON"}})).json()})),n.saveWinner=(e,a)=>t(void 0,void 0,void 0,(function*(){if(404===(yield n.isInWinner(e)))yield n.createWinner({id:e,wins:1,time:a});else{const t=yield n.getWinner(e);yield n.updateWinner(e,{id:e,wins:t.wins+1,time:a<t.time?a:t.time})}})),n.deleteWinner=e=>t(void 0,void 0,void 0,(function*(){404!==(yield n.isInWinner(e))&&(yield fetch(`${o}/${e}`,{method:"DELETE"}))})),n.deleteCar=e=>t(void 0,void 0,void 0,(function*(){(yield fetch(`${i}/${e}`,{method:"DELETE"})).json(),yield n.deleteWinner(e)}))},607:function(e,n,t){var a=this&&this.__awaiter||function(e,n,t,a){return new(t||(t=Promise))((function(i,r){function o(e){try{d(a.next(e))}catch(e){r(e)}}function s(e){try{d(a.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((a=a.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const i=t(203),r=t(593),o=t(14),s=t(20),d=t(739),c=t(218);t(387);const l=t(367),u=()=>a(void 0,void 0,void 0,(function*(){const e=yield i.getCars(l.state.garagePage,7);l.state.garagePagesCount=Math.ceil(Number(e.count)/7),console.log(e.items,l.state.garagePagesCount),document.body.innerHTML=`\n  ${s.renderHeader()}\n  <div id="nav" class="garage-view">\n  <h2 class="pop-up"></h2>\n    <div class="form">${d.renderForm()}</div>\n    <h4 class="car__count">Garage (${e.count})</h4>\n    <h5>Page #(${l.state.garagePage})</h5>\n    <div class="garage"></div>\n    <nav>\n      <ul class="pagination">\n        <li class="page-item">\n          <a id="prevPage" class="page-link" data-view="garage" href="#">Previous</a>\n        </li>\n        <li class="page-item">\n          <a id="nextPage" class="page-link" data-view="garage" href="#">Next</a>\n        </li>\n      </ul>\n    </nav>\n  </div>\n  <div id="nav" class="winners hidden">\n  <h4 class="winners__count"></h4>\n  <h5 class="winners__page"></h5>\n  <table class="table table-striped table-sm">\n  <thead>\n    <tr>\n      <th scope="col">#</th>\n      <th scope="col">Car</th>\n      <th scope="col">Name</th>\n      <th scope="col" class="sort" data-sort="wins">Wins</th>\n      <th scope="col" class="sort" data-sort="time">Time <i class="bi bi-sort-numeric-down"></i></th>\n    </tr>\n  </thead>\n  <tbody class="table-result">\n  </tbody>\n</table>\n <nav>\n      <ul class="pagination">\n        <li class="page-item">\n          <a id="prevPage" class="page-link" data-view="winners" href="#">Previous</a>\n        </li>\n        <li class="page-item">\n          <a id="nextPage" class="page-link" data-view="winners" href="#">Next</a>\n        </li>\n      </ul>\n    </nav>\n  </div>`,e.items.forEach((e=>{r.$(".garage").innerHTML+=o.renderCar(e)})),c.renderWinners()}));document.body.addEventListener("submit",(e=>a(void 0,void 0,void 0,(function*(){if(null===e.target)return;const n=e.target;if("formCreateCar"===n.id){const e={name:r.$("#formCreateCar").children[0].value,color:r.$("#formCreateCar").children[1].value};yield i.createCar(e)}if("formUpdateCar"===n.id){const e={name:r.$("#formUpdateCar").children[0].value,color:r.$("#formUpdateCar").children[1].value};yield i.updateCar(l.state.selectedCarId,e)}yield u()})))),document.body.addEventListener("click",(e=>a(void 0,void 0,void 0,(function*(){var n;if(null===e.target)return;const t=e.target;if("remove"===t.id){const e=Number(t.dataset.id);yield i.deleteCar(e),yield u()}if("select"===t.id){l.state.selectedCarId=Number(t.dataset.id);const e=yield i.getCar(l.state.selectedCarId);r.enableForm(e)}if(t.classList.contains("engine")){const e=Number(t.dataset.id);r.race(e),null===(n=t.nextElementSibling)||void 0===n||n.removeAttribute("disabled")}if(t.classList.contains("reset-car")){const e=Number(t.dataset.id);yield i.stopEngine(e),yield cancelAnimationFrame(l.state.amimation[e]),r.$(`#car-${e}`).style.marginLeft=""}if("startRace"===t.id){t.setAttribute("disabled","");let e=!1;r.$(".garage").querySelectorAll(".car__svg").forEach((n=>a(void 0,void 0,void 0,(function*(){const t=Number(n.dataset.id),a=yield r.race(t);!1===a.success||e||(e=!0,yield c.winnerHandler(a))}))))}"resetRace"===t.id&&(r.$(".pop-up").innerHTML="",t.setAttribute("disabled",""),document.querySelectorAll(".car__svg").forEach((e=>a(void 0,void 0,void 0,(function*(){const n=Number(e.dataset.id);yield i.stopEngine(n),yield cancelAnimationFrame(l.state.amimation[n]),e.style.marginLeft=""})))),r.$("#startRace").removeAttribute("disabled")),"nextPage"===t.id&&("garage"===t.dataset.view&&l.state.garagePage<l.state.garagePagesCount?(l.state.garagePage++,u()):l.state.winnerPage<l.state.winnersPagesCount&&(l.state.winnerPage++,c.renderWinners())),"prevPage"===t.id&&("garage"===t.dataset.view&&l.state.garagePage>1?(l.state.garagePage--,u()):"winners"===t.dataset.view&&l.state.winnerPage>1&&(l.state.winnerPage--,c.renderWinners())),"winners"===t.id&&(document.querySelectorAll(".nav-link"),r.$(".garage-view").classList.add("hidden"),r.$(".winners").classList.remove("hidden")),"garage"===t.id&&(document.querySelectorAll(".nav-link"),r.$(".winners").classList.add("hidden"),r.$(".garage-view").classList.remove("hidden")),t.classList.contains("sort")&&(l.state.sortBy!==t.dataset.sort?l.state.sortBy=t.dataset.sort:l.state.orderBy="DESC"===l.state.orderBy?"ASC":"DESC",c.renderWinners()),"generateCars"===t.id&&(yield r.generateCars(),yield u())})))),u()},367:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.state=void 0,n.state={garagePage:1,winnerPage:1,sortBy:"id",orderBy:"ASC",selectedCarId:null,amimation:{},view:"garage",winner:null,garagePagesCount:0,winnersPagesCount:0}},14:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.renderCar=void 0;const a=t(437);n.renderCar=e=>`\n<div class="road">\n <div class="car-wrapper">\n    <div class="btn-group" role="group">\n      <button id='select' type="button" class="btn btn-primary btn-sm select"\n      data-id="${e.id}">select</button>\n      <button id="remove" type="button" class="btn btn-danger btn-sm remove"\n      data-id="${e.id}">\n      remove</button>\n      <span>${e.name}</span>\n    </div>\n    <div class="car">\n      <button id='engine-${e.id}'\n       type="button" class="btn btn-outline-success car__button engine"\n      data-id="${e.id}">\n        A\n      </button>\n      <button id='resetCar-${e.id}' type="button" class="btn btn-outline-danger\n      car__button reset-car" data-id="${e.id}" disabled>B</button>\n    ${a.renderCarImage(e)}\n    </div>\n  </div>\n<div class="road__flag"></div>`},437:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.renderCarImage=void 0,n.renderCarImage=e=>`\n    <svg\n      version="1.1"\n      id="car-${e.id}"\n      data-id = "${e.id}"\n      class="car__svg"\n      preserveAspectRatio="none"\n      xmlns="http://www.w3.org/2000/svg"\n      xmlns:xlink="http://www.w3.org/1999/xlink"\n      viewBox="0 0 324.018 224.017"\n    >\n      <path\n        d="M317.833,197.111c3.346-11.148,2.455-20.541-2.65-27.945c-9.715-14.064-31.308-15.864-35.43-16.076l-8.077-4.352\n      l-0.528-0.217c-8.969-2.561-42.745-3.591-47.805-3.733c-7.979-3.936-14.607-7.62-20.475-10.879\n      c-20.536-11.413-34.107-18.958-72.959-18.958c-47.049,0-85.447,20.395-90.597,23.25c-2.812,0.212-5.297,\n      0.404-7.646,0.59\n      l-6.455-8.733l7.34,0.774c2.91,0.306,4.267-1.243,3.031-3.459c-1.24-2.216-4.603-4.262-7.519-4.57l-23.951-2.524\n      c-2.91-0.305-4.267,1.243-3.026,3.459c1.24,2.216,4.603,4.262,7.519,4.57l3.679,0.386l8.166,11.05\n      c-13.823,1.315-13.823,2.139-13.823,4.371c0,18.331-2.343,22.556-2.832,23.369L0,164.443v19.019l2.248,2.89\n      c-0.088,2.775,0.823,5.323,2.674,7.431c5.981,6.804,19.713,7.001,21.256,7.001c4.634,0,14.211-2.366,20.78-4.153\n      c-0.456-0.781-0.927-1.553-1.3-2.392c-0.36-0.809-0.603-1.668-0.885-2.517c-0.811-2.485-1.362-5.096-1.362-7.845\n      c0-14.074,11.449-25.516,25.515-25.516s25.52,11.446,25.52,25.521c0,6.068-2.221,11.578-5.773,15.964\n      c-0.753,0.927-1.527,1.828-2.397,2.641c-1.022,0.958-2.089,1.859-3.254,2.641c29.332,0.109,112.164,\n      0.514,168.708,1.771\n      c-0.828-0.823-1.533-1.771-2.237-2.703c-0.652-0.854-1.222-1.75-1.761-2.688c-2.164-3.744-3.5-8.025-3.5-12.655\n      c0-14.069,11.454-25.513,25.518-25.513c14.064,0,25.518,11.449,25.518,25.513c0,5.126-1.553,9.875-4.152,13.878\n      c-0.605,0.922-1.326,1.755-2.04,2.594c-0.782,0.922-1.616,1.781-2.527,2.584c5.209,0.155,9.699,0.232,13.546,0.232\n      c19.563,0,23.385-1.688,23.861-5.018C324.114,202.108,324.472,199.602,317.833,197.111z"\n        fill="${e.color}"\n      />\n      <path\n        d="M52.17,195.175c3.638,5.379,9.794,8.922,16.756,8.922c0.228,0,0.44-0.062,0.663-0.073c2.576-0.083,\n        5.043-0.61,7.291-1.574\n      c1.574-0.678,2.996-1.6,4.332-2.636c4.782-3.702,7.927-9.429,7.927-15.933c0-11.144-9.066-20.216-20.212-20.216\n      s-20.213,9.072-20.213,20.216c0,2.263,0.461,4.411,1.149,6.446c0.288,0.85,0.616,1.673,1.015,2.471\n      C51.279,193.606,51.667,194.434,52.17,195.175z"\n        fill="${e.color}"\n      />\n      <path\n        d="M269.755,209.068c2.656,0,5.173-0.549,7.503-1.481c1.589-0.642,3.06-1.491,4.422-2.495\n      c1.035-0.767,1.988-1.616,2.863-2.559c3.34-3.604,5.432-8.389,5.432-13.681c0-11.144-9.071-20.21-20.215-20.21\n      s-20.216,9.066-20.216,20.21c0,4.878,1.812,9.3,4.702,12.801c0.818,0.989,1.719,1.89,2.708,2.713\n      c1.311,1.088,2.729,2.024,4.293,2.755C263.836,208.333,266.704,209.068,269.755,209.068z"\n        fill="${e.color}"\n      />\n    </svg>`},739:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.renderForm=void 0,n.renderForm=()=>'\n      <form id="formCreateCar" class="form-create input-group-sm">\n        <input type="text" class="form-control"\n          id="inputCarName" placeholder="Car name"\n          required/>\n        <input type="color" class="form-control form-control-color"\n          id="ColorInput" value="#563d7c"\n          title="Choose your color"\n          required\n        />\n        <button type="submit" class="btn btn-primary">Create</button>\n      </form>\n      <form id="formUpdateCar" class="form-create input-group-sm">\n        <input\n          type="text"\n          class="form-control"\n          id="updateCarName "\n          placeholder="New car name"\n          disabled\n        />\n        <input\n          type="color"\n          class="form-control form-control-color"\n          id="ColorUpdate"\n          value="#563d7c"\n          title="Choose your color"\n          disabled\n        />\n        <button type="submit" class="btn btn-primary" disabled>\n          Update\n        </button>\n      </form>\n      <div class = "btn-group"><button  id="startRace" type="button" class="btn btn-danger">Race</button>\n      <button  id="resetRace" type="button" class="btn btn-info" disabled>Reset</button>\n      <button  id="generateCars" type="button" class="btn btn-success">Generate Cars</button></div>\n\n      '},20:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.renderHeader=void 0,n.renderHeader=()=>'\n<nav class="navbar navbar-expand-sm navbar-light bg-success">\n <div class="container-fluid">\n   <a class="navbar-brand" href="#">Async Race</a>\n   <div class="collapse navbar-collapse" id="navbarNav">\n     <ul class="navbar-nav">\n       <li class="nav-item">\n         <a id="garage" class="nav-link" href="#">garage</a>\n       </li>\n       <li class="nav-item">\n         <a id="winners" class="nav-link" href="#">winners</a>\n       </li>\n     </ul>\n   </div>\n </div>\n</nav>'},218:function(e,n,t){var a=this&&this.__awaiter||function(e,n,t,a){return new(t||(t=Promise))((function(i,r){function o(e){try{d(a.next(e))}catch(e){r(e)}}function s(e){try{d(a.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((a=a.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.winnerHandler=n.renderWinners=void 0;const i=t(203),r=t(367),o=t(593),s=t(437);n.renderWinners=()=>a(void 0,void 0,void 0,(function*(){const e=yield i.getWinners(r.state.winnerPage,10,r.state.sortBy,r.state.orderBy);let n=0;const t=yield i.getAllCars();r.state.winnersPagesCount=Math.ceil(Number(e.count)/10),o.$(".winners__count").innerHTML=`Winners (${e.count})`,o.$(".winners__page").innerHTML=`Page #(${r.state.winnerPage})`,o.$(".table-result").innerHTML="",e.items.forEach((e=>a(void 0,void 0,void 0,(function*(){o.$(".table-result").innerHTML+=((e,n,t)=>`\n    <tr>\n      <th scope="row">${t+1}</th>\n      <td>${s.renderCarImage(n)}</td>\n      <td>${n.name}</td>\n      <td>${e.wins}</td>\n      <td>${e.time}</td>\n    </tr>\n`)(e,t.items[e.id],n+10*(r.state.winnerPage-1)),n++}))))})),n.winnerHandler=e=>a(void 0,void 0,void 0,(function*(){const t=(e.time/1e3).toFixed(2);yield i.saveWinner(e.carId,t),yield i.getCar(e.carId).then((e=>{o.$(".pop-up").innerHTML=`${e.name} went first (${t}s)!!`})),o.$("#resetRace").removeAttribute("disabled"),yield n.renderWinners()}))},593:function(e,n,t){var a=this&&this.__awaiter||function(e,n,t,a){return new(t||(t=Promise))((function(i,r){function o(e){try{d(a.next(e))}catch(e){r(e)}}function s(e){try{d(a.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}d((a=a.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.generateCars=n.race=n.animate=n.enableForm=n.disableForm=n.$=void 0;const i=t(203),r=t(367),o=["Tesla","Porsche","Ferrari","BMW","Audi","VAZ","Mercedes","Lamborgini","Skoda","Tayota"],s=["911","huracan","model S","m5","e-tron","2101","R8","Octavia RS","Camry 3.5","AMG"];function d({carId:e,duration:t}){const a=performance.now();r.state.amimation[e]=requestAnimationFrame((function i(o){let s=(o-a)/t;s>1&&(s=1),n.$(`#car-${e}`).style.marginLeft=s*(window.innerWidth-210)+"px",s<1&&(r.state.amimation[e]=requestAnimationFrame(i))}))}n.$=e=>document.querySelector(e),n.disableForm=()=>{document.querySelectorAll("#formUpdateCar *").forEach((e=>{e.setAttribute("disabled","")}))},n.enableForm=e=>{n.$("#formUpdateCar").children[0].value=e.name,n.$("#formUpdateCar").children[1].value=e.color,document.querySelectorAll("#formUpdateCar *").forEach((e=>{e.removeAttribute("disabled")}))},n.animate=d,n.race=e=>a(void 0,void 0,void 0,(function*(){const n=yield i.startEngine(e),t=n.distance/n.velocity;d({duration:t,carId:e});const{success:a}=yield i.drive(e);return a||cancelAnimationFrame(r.state.amimation[e]),{success:a,carId:e,time:t}}));const c=()=>{let e="#";for(let n=0;n<6;n++)e+="0123456789ABCDEF"[Math.floor(15*Math.random())];return e};n.generateCars=()=>a(void 0,void 0,void 0,(function*(){const e=[];for(let n=0;n<100;n++){const n={name:`${o[Math.floor(Math.random()*o.length)]} ${s[Math.floor(Math.random()*s.length)]}`,color:c()};e.push(i.createCar(n))}Promise.all(e)}))}},n={};function t(a){var i=n[a];if(void 0!==i)return i.exports;var r=n[a]={exports:{}};return e[a].call(r.exports,r,r.exports,t),r.exports}t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(607)})();